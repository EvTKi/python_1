# CIM Role Generator

Генератор CIM/RDF/XML для ролей и подразделений организаций по данным из CSV

---

## Описание

Python-скрипт для автоматического создания XML в формате CIM/RDF на основании табличных данных о подразделениях из CSV-файлов.

Каждый обрабатываемый CSV (кроме `Sample.csv`) формирует свой XML-файл (с совпадающим именем), а также отдельный лог-файл в папке `log/`, где отражается процесс обработки, результат добавления ролей и обнаруженные ошибки.

---

## Возможности

- Обработка всех `.csv` файлов в текущей директории **(кроме Sample.csv)**
- Для каждой строки CSV создаётся уникальная связка ролей (Role) и прав (Privilege), объект группы данных (DataGroup) и ссылку (ObjectReference)
- Каждый XML-файл сохраняется под именем исходного CSV (например, `myorg.csv` → `myorg.xml`)
- Формирование логов для каждого входного файла (папка log/)
- Строгое логирование ошибок и событий с таймштампами
- Работа продолжается даже при наличии ошибок в отдельных строках или файлах

---

## Установка

1. Скопируйте скрипт и свои `.csv` файлы в одну директорию (файл Sample.csv будет всегда игнорироваться!)
2. Установите необходимые библиотеки:

    ```
    pip install lxml
    ```

---

## Использование

1. Убедитесь, что структура CSV соответствует формату:

    ```
    dep_uid;dep_name;dep_headdep_uid;dep_headdep_name;org_uid;org_name
    fc7f76ef-e381-4659-82f6-2e7a5ba097b8;Отдел_1;...;...;...;Организация_1
    ```

2. Запустите скрипт:

    ```
    python имя_скрипта.py
    ```

3. Введите UID папки для ролей (`folder_uid`), когда будет запрошено (любой валидный UUID4). Один UID будет использоваться для всех обрабатываемых файлов за одно выполнение скрипта.

---

## Результат

- Для каждого файла (например, `data.csv`) будет создан файл `data.xml` в той же папке.
- Для каждого файла формируется отдельный лог: `log/data.log`
- Логи содержат все действия, а также сообщения об ошибках.

---

## Пример логов

[2025-08-04 14:50:41] INFO: Старт обработки файла data.csv → data.xml
[2025-08-04 14:50:42] INFO: Строка 2: Добавляется роль: Организация_1\Отдел_1, dep_uid=fc7f76ef-e381-4659-82f6-2e7a5ba097b8
[2025-08-04 14:50:42] ERROR: Ошибка при обработке строки 3 в data.csv: KeyError: 'org_name'
[2025-08-04 14:50:42] INFO: Завершена обработка файла. Всего добавлено ролей: 1. XML сохранён: data.xml


---

## Структура результата

* myorg.csv      → myorg.xml
* myorg.csv      → log/myorg.log
* Sample.csv     — всегда игнорируется

---

## FAQ

- Если в логе появляется ERROR — проверьте поля и структуру CSV-файла.
- Если файл не обработан — убедитесь, что он не называется Sample.csv.
- UID папки вводится один раз и будет общим для всех ролей.

---

## Требования

- Python 3.7 и выше
- lxml

---

## Контакты

По вопросам интеграции и модификации скрипта — обратитесь к разработчику вашей системы.

